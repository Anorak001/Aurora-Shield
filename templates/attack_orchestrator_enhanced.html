<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aurora Shield - Enhanced Attack Orchestrator</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --bg-900: #0b1220;
            --bg-800: #0f1726;
            --bg-700: #121627;
            --accent: #9b7cff;
            --accent-2: #7ee0f6;
            --success: #00ff88;
            --warning: #ffa502;
            --danger: #ff4757;
            --muted: #98a0b3;
            --glass: rgba(255,255,255,0.03);
        }

        body {
            font-family: 'Inter', 'Segoe UI', sans-serif;
            background: radial-gradient(1000px 400px at 10% 10%, rgba(123,87,232,0.06), transparent 10%),
                        radial-gradient(800px 300px at 90% 90%, rgba(53,60,188,0.04), transparent 12%),
                        var(--bg-900);
            color: #dbe6ff;
            min-height: 100vh;
        }

        .container { max-width: 1600px; margin: 0 auto; padding: 24px; }

        .header {
            text-align: center;
            margin-bottom: 32px;
            background: linear-gradient(180deg, rgba(20,24,40,0.6), rgba(10,12,20,0.55));
            border-radius: 14px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .header h1 {
            font-size: 28px;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .header p {
            color: var(--muted);
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255,255,255,0.03);
            box-shadow: 0 8px 24px rgba(2,6,20,0.6);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            margin-bottom: 8px;
        }

        .stat-label {
            color: var(--muted);
            font-size: 14px;
        }

        .controls-panel {
            background: linear-gradient(180deg, rgba(20,24,40,0.6), rgba(10,12,20,0.55));
            border-radius: 14px;
            padding: 24px;
            margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            color: white;
            background-color: #46686b;
        }

        .btn-primary { background: var(--accent); }
        .btn-success { background: var(--success); }
        .btn-warning { background: var(--warning); }
        .btn-danger { background: var(--danger); }

        .btn:hover { transform: translateY(-1px); filter: brightness(1.1); }

        .bots-table {
            background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid rgba(255,255,255,0.03);
        }

        .bots-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .bots-table th {
            background: linear-gradient(90deg, rgba(155,124,255,0.1), rgba(126,224,246,0.05));
            padding: 16px 12px;
            text-align: left;
            font-weight: 600;
            color: var(--accent);
            font-size: 13px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .bots-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            font-size: 12px;
            color: #dbe6ff;
        }

        .bots-table tr:hover {
            background: rgba(255,255,255,0.02);
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: 600;
            font-size: 10px;
            text-transform: uppercase;
        }

        .status-active { background: rgba(0,255,136,0.2); color: var(--success); }
        .status-paused { background: rgba(255,165,2,0.2); color: var(--warning); }
        .status-stopped { background: rgba(255,71,87,0.2); color: var(--danger); }

        .attack-type-badge {
            display: inline-block;
            padding: 3px 6px;
            border-radius: 3px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .attack-http_flood { background: rgba(155,124,255,0.2); color: var(--accent); }
        .attack-ddos_burst { background: rgba(255,71,87,0.2); color: var(--danger); }
        .attack-slowloris { background: rgba(255,165,2,0.2); color: var(--warning); }
        .attack-brute_force { background: rgba(126,224,246,0.2); color: var(--accent-2); }
        .attack-resource_exhaustion { background: rgba(255,20,147,0.2); color: #ff69b4; }

        .action-btn {
            padding: 4px 8px;
            margin: 2px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 10px;
            font-weight: 600;
            color: white;
            transition: all 0.2s ease;
        }

        .action-btn:hover { transform: translateY(-1px); }

        .ip-family { font-family: 'Courier New', monospace; }

        .create-bot-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            padding: 20px;
            background: rgba(255,255,255,0.02);
            border-radius: 8px;
            margin-top: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: var(--accent);
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .form-group input, .form-group select {
            padding: 8px;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 4px;
            background: var(--bg-700);
            color: #dbe6ff;
            font-size: 12px;
        }

        .auto-refresh {
            text-align: center;
            margin-top: 16px;
            color: var(--muted);
            font-size: 12px;
        }

        .refresh-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        /* Tab Navigation Styles */
        .tab-navigation {
            display: flex;
            gap: 8px;
            margin-bottom: 24px;
            background: rgba(20,24,40,0.4);
            padding: 8px;
            border-radius: 12px;
            border: 1px solid rgba(255,255,255,0.03);
        }

        .tab-btn {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: var(--muted);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .tab-btn.active {
            background: var(--accent);
            color: white;
            box-shadow: 0 4px 12px rgba(155, 124, 255, 0.3);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(255,255,255,0.05);
            color: var(--accent-2);
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        /* Analytics Styles */
        .analytics-panel {
            background: linear-gradient(180deg, rgba(20,24,40,0.6), rgba(10,12,20,0.55));
            border-radius: 14px;
            padding: 24px;
            border: 1px solid rgba(255,255,255,0.04);
        }

        .analytics-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 32px;
        }

        .chart-container {
            background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.02));
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            border: 1px solid rgba(255,255,255,0.03);
            box-shadow: 0 8px 24px rgba(2,6,20,0.6);
        }

        .chart-container canvas {
            max-width: 100%;
            height: auto !important;
            background: rgba(11, 18, 32, 0.3);
            border-radius: 8px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .subnet-info {
            font-size: 10px;
            color: var(--muted);
            font-family: monospace;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255,255,255,0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            transition: width 0.3s ease;
        }

        /* Analytics Charts Grid */
        .analytics-charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .analytics-charts-grid .chart-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .analytics-charts-grid .chart-container h4 {
            text-align: center;
            width: 100%;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .analytics-charts-grid .chart-container canvas {
            max-width: 100%;
            height: auto !important;
        }

        /* Timeline chart spans full width */
        .timeline-container {
            grid-column: 1 / -1;
        }

        /* Responsive chart sizes */
        @media (max-width: 1200px) {
            .analytics-charts-grid {
                grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .analytics-charts-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Enhanced Attack Orchestrator</h1>
            <p>Virtual IP Management ‚Ä¢ Multi-Subnet Attacks ‚Ä¢ Real-time Control</p>
        </div>

        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-btn active" onclick="switchTab('control')">üéÆ Bot Control</button>
            <button class="tab-btn" onclick="switchTab('analytics')">üìä Analytics</button>
        </div>

        <!-- Bot Control Tab -->
        <div id="control-tab" class="tab-content active">
            <!-- Statistics Overview -->
            <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalBots">0</div>
                <div class="stat-label">Total Bots</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="activeBots">0</div>
                <div class="stat-label">Active Bots</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalRequests">0</div>
                <div class="stat-label">Total Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="blockRate">0%</div>
                <div class="stat-label">Block Rate</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="attackTypes">0</div>
                <div class="stat-label">Attack Types</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="subnetsCount">0</div>
                <div class="stat-label">Active Subnets</div>
            </div>
        </div>

        <!-- Controls Panel -->
        <div class="controls-panel">
            <h3 style="color: var(--accent); margin-bottom: 16px;">üéÆ Bot Fleet Control</h3>
            
            <div class="controls-grid">
                <button class="btn btn-success" onclick="startAllBots()">‚ñ∂Ô∏è Start All</button>
                <button class="btn btn-danger" onclick="stopAllBots()">‚èπÔ∏è Stop All</button>
                <button class="btn btn-danger" onclick="deleteAllBots()">üóëÔ∏è Delete All Bots</button>
                <button class="btn btn-primary" onclick="createRandomBotsPrompt()">ü§ñ Create Random Bots</button>
                <button class="btn btn-success" onclick="createLegitimateBot()">üë§ Add Legitimate User</button>
                <button class="btn btn-warning" onclick="toggleCreateForm()">‚öôÔ∏è Custom Bot</button>
                <button class="btn btn-primary" onclick="refreshData()">üîÑ Refresh</button>
                <button class="btn btn-info" onclick="switchTab('analytics')">üìä Analytics</button>
            </div>

            <!-- Create Bot Form -->
            <div id="createBotForm" class="create-bot-form" style="display: none;">
                <h4 style="color: var(--accent); margin-bottom: 16px; grid-column: span 2;">üîß Custom Bot Configuration</h4>
                
                <div class="form-group">
                    <label>Number of Bots</label>
                    <input type="number" id="botCount" min="1" max="100" value="1" placeholder="How many bots to create">
                </div>
                
                <div class="form-group">
                    <label>Attack Type</label>
                    <select id="attackType">
                        <option value="normal">Normal (Legitimate Traffic)</option>
                        <option value="http_flood">HTTP Flood</option>
                        <option value="ddos_burst">DDoS Burst</option>
                        <option value="slowloris">Slowloris</option>
                        <option value="brute_force">Brute Force</option>
                        <option value="resource_exhaustion">Resource Exhaustion</option>
                        <option value="syn_flood">SYN Flood</option>
                        <option value="udp_flood">UDP Flood</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Rate (req/sec)</label>
                    <input type="number" id="customRate" min="0.1" max="1000" step="0.1" value="10" placeholder="Requests per second">
                </div>
                
                <div class="form-group">
                    <label>Duration (seconds)</label>
                    <input type="number" id="customDuration" min="10" max="3600" value="60" placeholder="Attack duration">
                </div>
                
                <div class="form-group">
                    <label>Target URL</label>
                    <input type="text" id="customTarget" value="http://localhost:8080" placeholder="Full target URL">
                </div>
                
                <div class="form-group">
                    <label>Target Path</label>
                    <input type="text" id="customPath" value="/api/test" placeholder="/api/endpoint">
                </div>
                
                <div class="form-group">
                    <label>User Agent</label>
                    <input type="text" id="customUserAgent" value="CustomBot/1.0" placeholder="Bot User Agent">
                </div>
                
                <div class="form-group">
                    <label>Payload Size (bytes)</label>
                    <input type="number" id="customPayload" min="0" max="50000" value="1000" placeholder="Request payload size">
                </div>
                
                <div class="form-group">
                    <label>Concurrent Connections</label>
                    <input type="number" id="customConnections" min="1" max="1000" value="10" placeholder="Concurrent connections">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="randomizeHeaders"> Randomize Headers
                    </label>
                </div>
                
                <div class="form-group" style="grid-column: span 2;">
                    <button class="btn btn-success" onclick="createCustomBots()">üöÄ Create Custom Bots</button>
                    <button class="btn btn-secondary" onclick="resetForm()">üîÑ Reset Form</button>
                </div>
            </div>
        </div>

        <!-- Bots Table -->
        <div class="bots-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>IP Address</th>
                        <th>Subnet</th>
                        <th>Attack Type</th>
                        <th>Status</th>
                        <th>Rate</th>
                        <th>Requests</th>
                        <th>Success</th>
                        <th>Blocked</th>
                        <th>Uptime</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="botsTableBody">
                    <!-- Bots will be populated here -->
                </tbody>
            </table>
        </div>

        <div class="auto-refresh">
            <span class="refresh-dot"></span>
            Auto-refreshing bot status every 3 seconds
        </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics-tab" class="tab-content">
            <div class="analytics-panel">
                <h3 style="color: var(--accent); margin-bottom: 16px;">üìä Real-time Analytics</h3>
                
                <!-- Analytics Stats Grid -->
                <div class="analytics-stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalRequestsAnalytics">0</div>
                        <div class="stat-label">Total Requests</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="requestsPerSecond">0</div>
                        <div class="stat-label">Requests/Second</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgResponseTime">0ms</div>
                        <div class="stat-label">Avg Response Time</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="errorRate">0%</div>
                        <div class="stat-label">Error Rate</div>
                    </div>
                </div>

                <!-- Analytics Charts Grid -->
                <div class="analytics-charts-grid">
                    <!-- Request Types Chart -->
                    <div class="chart-container">
                        <h4 style="color: var(--accent-2); margin-bottom: 12px;">
                            <i class="fas fa-chart-bar"></i> Request Types
                        </h4>
                        <canvas id="requestTypesChart" width="350" height="200"></canvas>
                    </div>

                    <!-- Response Status Chart -->
                    <div class="chart-container">
                        <h4 style="color: var(--accent-2); margin-bottom: 12px;">
                            <i class="fas fa-code"></i> Status Codes
                        </h4>
                        <canvas id="statusCodesChart" width="350" height="200"></canvas>
                    </div>

                    <!-- Attack Types Pie Chart -->
                    <div class="chart-container">
                        <h4 style="color: var(--accent-2); margin-bottom: 12px;">
                            <i class="fas fa-chart-pie"></i> Attack Types
                        </h4>
                        <canvas id="attackTypesChart" width="300" height="250"></canvas>
                    </div>

                    <!-- Real-time Request Timeline -->
                    <div class="chart-container timeline-container">
                        <h4 style="color: var(--accent-2); margin-bottom: 12px;">
                            <i class="fas fa-chart-line"></i> Request Timeline
                        </h4>
                        <canvas id="timelineChart" width="700" height="180"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let botsData = [];
        let refreshInterval;
        let createFormVisible = false;

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', function() {
            refreshData();
            startAutoRefresh();
        });

        function startAutoRefresh() {
            refreshInterval = setInterval(refreshData, 3000);
        }

        function refreshData() {
            fetch('/api/bots')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        botsData = data.bots;
                        updateStatistics(data.stats);
                        updateBotsTable();
                    }
                })
                .catch(error => {
                    console.error('Error fetching bots:', error);
                });
        }

        function updateStatistics(stats) {
            document.getElementById('totalBots').textContent = stats.total_bots;
            document.getElementById('activeBots').textContent = stats.active_bots;
            document.getElementById('totalRequests').textContent = stats.total_requests.toLocaleString();
            document.getElementById('blockRate').textContent = stats.block_rate.toFixed(1) + '%';
            document.getElementById('attackTypes').textContent = Object.keys(stats.attack_types).length;
            document.getElementById('subnetsCount').textContent = Object.keys(stats.subnets).length;
        }

        function updateBotsTable() {
            const tbody = document.getElementById('botsTableBody');
            let rows = '';

            botsData.forEach(bot => {
                const statusClass = `status-${bot.status}`;
                const attackClass = `attack-${bot.attack_type}`;
                const successRate = bot.total_requests > 0 ? ((bot.successful_requests / bot.total_requests) * 100).toFixed(1) : '0';
                const uptime = formatUptime(bot.uptime);

                rows += `
                    <tr>
                        <td class="ip-family">${bot.id.split('_')[1]}</td>
                        <td class="ip-family">${bot.ip}</td>
                        <td class="subnet-info">${bot.subnet}</td>
                        <td><span class="attack-type-badge ${attackClass}">${bot.attack_type}</span></td>
                        <td><span class="status-badge ${statusClass}">${bot.status}</span></td>
                        <td>${bot.rate.toFixed(1)}/s</td>
                        <td>${bot.total_requests}</td>
                        <td style="color: var(--success);">${bot.successful_requests} (${successRate}%)</td>
                        <td style="color: var(--danger);">${bot.blocked_requests}</td>
                        <td>${uptime}</td>
                        <td>
                            ${bot.status === 'stopped' ? 
                                `<button class="action-btn btn-success" onclick="startBot('${bot.id}')">‚ñ∂Ô∏è</button>` :
                                `<button class="action-btn btn-danger" onclick="stopBot('${bot.id}')">‚èπÔ∏è</button>`
                            }
                            ${bot.status === 'active' ? 
                                `<button class="action-btn btn-warning" onclick="pauseBot('${bot.id}')">‚è∏Ô∏è</button>` : ''
                            }
                            <button class="action-btn" style="background: var(--accent);" onclick="editBot('${bot.id}')">‚úèÔ∏è</button>
                            <button class="action-btn btn-danger" onclick="removeBot('${bot.id}')">üóëÔ∏è</button>
                        </td>
                    </tr>
                `;
            });

            if (botsData.length === 0) {
                rows = '<tr><td colspan="11" style="text-align: center; padding: 40px; color: var(--muted);">No bots created yet. Create your first bot!</td></tr>';
            }

            tbody.innerHTML = rows;
        }

        function formatUptime(seconds) {
            if (seconds < 60) return `${Math.floor(seconds)}s`;
            if (seconds < 3600) return `${Math.floor(seconds / 60)}m`;
            return `${Math.floor(seconds / 3600)}h ${Math.floor((seconds % 3600) / 60)}m`;
        }

        // Bot control functions
        function startBot(botId) {
            fetch(`/api/bots/${botId}/start`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        refreshData();
                    } else {
                        alert('Error: ' + data.error);
                    }
                });
        }

        function stopBot(botId) {
            fetch(`/api/bots/${botId}/stop`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        refreshData();
                    } else {
                        alert('Error: ' + data.error);
                    }
                });
        }

        function pauseBot(botId) {
            fetch(`/api/bots/${botId}/pause`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        refreshData();
                    } else {
                        alert('Error: ' + data.error);
                    }
                });
        }

        function removeBot(botId) {
            if (confirm('Remove this bot permanently?')) {
                fetch(`/api/bots/${botId}/remove`, { method: 'DELETE' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            refreshData();
                        } else {
                            alert('Error: ' + data.error);
                        }
                    });
            }
        }

        function editBot(botId) {
            const newRate = prompt('Enter new rate (requests/second):');
            if (newRate && !isNaN(newRate)) {
                fetch(`/api/bots/${botId}/config`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ rate: parseFloat(newRate) })
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        refreshData();
                    } else {
                        alert('Error: ' + data.error);
                    }
                });
            }
        }

        // Bulk operations
        function startAllBots() {
            fetch('/api/bots/bulk/start', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        refreshData();
                        alert(data.message);
                    }
                });
        }

        function stopAllBots() {
            fetch('/api/bots/bulk/stop', { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        refreshData();
                        alert(data.message);
                    }
                });
        }

        function createRandomBot() {
            fetch('/api/bots/create', { 
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    refreshData();
                } else {
                    alert('Error: ' + data.error);
                }
            });
        }

        function createLegitimateBot() {
            // Create a legitimate normal traffic bot with optimal bypass settings
            const legitimateConfig = {
                rate: 0.3,  // Low rate - 0.3 requests per second
                attack_duration: 300,  // 5 minutes
                target_url: 'http://load-balancer:8090/index.html',  // Target load balancer to trigger protection
                user_agent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                payload_size: 0  // No payload for normal requests
            };

            fetch('/api/bots/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    attack_type: 'normal',
                    config: legitimateConfig
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    refreshData();
                    alert('‚úÖ Legitimate user bot created! It will simulate normal browsing behavior and bypass all protection layers.');
                } else {
                    alert('Error: ' + data.error);
                }
            });
        }

        function toggleCreateForm() {
            createFormVisible = !createFormVisible;
            document.getElementById('createBotForm').style.display = createFormVisible ? 'grid' : 'none';
        }

        function createCustomBot() {
            const config = {
                rate: parseFloat(document.getElementById('customRate').value),
                attack_duration: parseInt(document.getElementById('customDuration').value),
                target_url: `http://aurora-shield:8080${document.getElementById('customPath').value}`,
                user_agent: document.getElementById('customUserAgent').value,
                payload_size: parseInt(document.getElementById('customPayload').value)
            };

            fetch('/api/bots/create', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    attack_type: document.getElementById('attackType').value,
                    config: config
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    refreshData();
                    toggleCreateForm();
                } else {
                    alert('Error: ' + data.error);
                }
            });
        }

        function exportLogs() {
            const logs = {
                timestamp: new Date().toISOString(),
                bots: botsData,
                statistics: {
                    total_bots: botsData.length,
                    active_bots: botsData.filter(b => b.status === 'active').length,
                    total_requests: botsData.reduce((sum, b) => sum + b.total_requests, 0)
                }
            };

            const blob = new Blob([JSON.stringify(logs, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `attack_orchestrator_logs_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Enhanced Bot Management Functions
        function createRandomBotsPrompt() {
            const count = prompt('How many random bots would you like to create?', '5');
            if (count && !isNaN(count) && parseInt(count) > 0) {
                createMultipleRandomBots(parseInt(count));
            }
        }

        function createMultipleRandomBots(count) {
            for (let i = 0; i < count; i++) {
                setTimeout(() => createRandomBot(), i * 200); // Stagger creation
            }
        }

        function deleteAllBots() {
            if (confirm('Are you sure you want to delete ALL bots? This action cannot be undone.')) {
                fetch('/api/bots/delete-all', {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        alert('All bots deleted successfully');
                        refreshData();
                    } else {
                        alert('Error deleting bots: ' + data.message);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Network error occurred');
                });
            }
        }

        function createCustomBots() {
            const count = parseInt(document.getElementById('botCount').value) || 1;
            const attackType = document.getElementById('attackType').value;
            const rate = parseFloat(document.getElementById('customRate').value);
            const duration = parseInt(document.getElementById('customDuration').value);
            const target = document.getElementById('customTarget').value;
            const path = document.getElementById('customPath').value;
            const userAgent = document.getElementById('customUserAgent').value;
            const payload = parseInt(document.getElementById('customPayload').value);
            const connections = parseInt(document.getElementById('customConnections').value);
            const randomizeHeaders = document.getElementById('randomizeHeaders').checked;

            const botConfig = {
                attack_type: attackType,
                rate: rate,
                duration: duration,
                target: target,
                path: path,
                user_agent: userAgent,
                payload_size: payload,
                concurrent_connections: connections,
                randomize_headers: randomizeHeaders
            };

            for (let i = 0; i < count; i++) {
                setTimeout(() => {
                    fetch('/api/bots/create', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(botConfig)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            console.log(`Bot ${i + 1}/${count} created successfully`);
                        } else {
                            console.error(`Error creating bot ${i + 1}:`, data.message);
                        }
                    })
                    .catch(error => {
                        console.error(`Network error creating bot ${i + 1}:`, error);
                    });
                }, i * 300); // Stagger creation
            }

            alert(`Creating ${count} custom bot(s)...`);
            toggleCreateForm(); // Hide form
            setTimeout(refreshData, count * 300 + 1000); // Refresh after all bots are created
        }

        function resetForm() {
            document.getElementById('botCount').value = '1';
            document.getElementById('attackType').value = 'normal';  // Default to normal traffic
            adjustFormDefaults('normal');  // Set appropriate defaults
        }

        // Adjust form defaults based on attack type
        function adjustFormDefaults(attackType) {
            const rateInput = document.getElementById('customRate');
            const durationInput = document.getElementById('customDuration');
            const targetInput = document.getElementById('customTarget');
            const pathInput = document.getElementById('customPath');
            const userAgentInput = document.getElementById('customUserAgent');
            const payloadInput = document.getElementById('customPayload');
            const connectionsInput = document.getElementById('customConnections');

            if (attackType === 'normal') {
                // Legitimate traffic defaults
                rateInput.value = '1';
                durationInput.value = '300';
                targetInput.value = 'http://load-balancer:8090';
                pathInput.value = '/';
                userAgentInput.value = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36';
                payloadInput.value = '100';
                connectionsInput.value = '1';
            } else if (attackType === 'brute_force') {
                // Brute force defaults
                rateInput.value = '5';
                durationInput.value = '120';
                targetInput.value = 'http://load-balancer:8090';
                pathInput.value = '/login';
                userAgentInput.value = 'BruteForce/1.0';
                payloadInput.value = '300';
                connectionsInput.value = '3';
            } else if (attackType === 'slowloris') {
                // Slowloris defaults
                rateInput.value = '0.5';
                durationInput.value = '180';
                targetInput.value = 'http://load-balancer:8090';
                pathInput.value = '/admin';
                userAgentInput.value = 'SlowClient/1.0';
                payloadInput.value = '50';
                connectionsInput.value = '20';
            } else {
                // Default attack settings
                rateInput.value = '10';
                durationInput.value = '60';
                targetInput.value = 'http://load-balancer:8090';
                pathInput.value = '/api/test';
                userAgentInput.value = 'AttackBot/1.0';
                payloadInput.value = '1000';
                connectionsInput.value = '10';
            }
        }

        // Add event listener for attack type changes
        document.addEventListener('DOMContentLoaded', function() {
            const attackTypeSelect = document.getElementById('attackType');
            if (attackTypeSelect) {
                attackTypeSelect.addEventListener('change', function() {
                    adjustFormDefaults(this.value);
                });
                // Set initial defaults
                adjustFormDefaults('normal');
            }
        });

        // Tab Management
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');

            // Initialize analytics if switching to analytics tab
            if (tabName === 'analytics') {
                initializeAnalytics();
            }
        }

        // Analytics Functions
        let charts = {};
        let analyticsData = {
            requestTypes: {},
            statusCodes: {},
            timeline: [],
            attackTypes: {}
        };

        function initializeAnalytics() {
            if (!charts.requestTypes) {
                initializeCharts();
            }
            updateAnalyticsData();
        }

        function initializeCharts() {
            // Request Types Chart
            const ctx1 = document.getElementById('requestTypesChart').getContext('2d');
            charts.requestTypes = new Chart(ctx1, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Request Count',
                        data: [],
                        backgroundColor: 'rgba(155, 124, 255, 0.6)',
                        borderColor: 'rgba(155, 124, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    },
                    plugins: {
                        legend: { labels: { color: '#dbe6ff' } }
                    }
                }
            });

            // Status Codes Chart
            const ctx2 = document.getElementById('statusCodesChart').getContext('2d');
            charts.statusCodes = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            'rgba(0, 255, 136, 0.6)',
                            'rgba(255, 165, 2, 0.6)',
                            'rgba(255, 71, 87, 0.6)',
                            'rgba(126, 224, 246, 0.6)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#dbe6ff' } }
                    }
                }
            });

            // Timeline Chart
            const ctx3 = document.getElementById('timelineChart').getContext('2d');
            charts.timeline = new Chart(ctx3, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Requests per Second',
                        data: [],
                        borderColor: 'rgba(126, 224, 246, 1)',
                        backgroundColor: 'rgba(126, 224, 246, 0.1)',
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    },
                    plugins: {
                        legend: { labels: { color: '#dbe6ff' } }
                    }
                }
            });

            // Attack Types Chart
            const ctx4 = document.getElementById('attackTypesChart').getContext('2d');
            charts.attackTypes = new Chart(ctx4, {
                type: 'pie',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        backgroundColor: [
                            'rgba(155, 124, 255, 0.6)',
                            'rgba(126, 224, 246, 0.6)',
                            'rgba(255, 165, 2, 0.6)',
                            'rgba(255, 71, 87, 0.6)',
                            'rgba(0, 255, 136, 0.6)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: { labels: { color: '#dbe6ff' } }
                    }
                }
            });
        }

        function updateAnalyticsData() {
            fetch('/api/analytics')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateAnalyticsStats(data.analytics);
                        updateCharts(data.analytics);
                    }
                })
                .catch(error => {
                    console.error('Error fetching analytics:', error);
                });
        }

        function updateAnalyticsStats(analytics) {
            document.getElementById('totalRequestsAnalytics').textContent = analytics.total_requests.toLocaleString();
            document.getElementById('requestsPerSecond').textContent = analytics.requests_per_second.toFixed(1);
            document.getElementById('avgResponseTime').textContent = analytics.avg_response_time + 'ms';
            document.getElementById('errorRate').textContent = analytics.error_rate.toFixed(1) + '%';
        }

        function updateCharts(analytics) {
            // Update Request Types Chart
            if (charts.requestTypes) {
                charts.requestTypes.data.labels = Object.keys(analytics.request_types);
                charts.requestTypes.data.datasets[0].data = Object.values(analytics.request_types);
                charts.requestTypes.update();
            }

            // Update Status Codes Chart
            if (charts.statusCodes) {
                charts.statusCodes.data.labels = Object.keys(analytics.status_codes);
                charts.statusCodes.data.datasets[0].data = Object.values(analytics.status_codes);
                charts.statusCodes.update();
            }

            // Update Timeline Chart
            if (charts.timeline && analytics.timeline) {
                charts.timeline.data.labels = analytics.timeline.map(point => point.time);
                charts.timeline.data.datasets[0].data = analytics.timeline.map(point => point.requests);
                charts.timeline.update();
            }

            // Update Attack Types Chart
            if (charts.attackTypes) {
                charts.attackTypes.data.labels = Object.keys(analytics.attack_types);
                charts.attackTypes.data.datasets[0].data = Object.values(analytics.attack_types);
                charts.attackTypes.update();
            }
        }

        // Enhanced refresh to update analytics
        function refreshData() {
            fetch('/api/bots')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        botsData = data.bots;
                        updateStatistics(data.stats);
                        updateBotsTable();
                        
                        // Update analytics if on analytics tab
                        if (document.getElementById('analytics-tab').classList.contains('active')) {
                            updateAnalyticsData();
                        }
                    }
                })
                .catch(error => {
                    console.error('Error fetching bots:', error);
                });
        }
    </script>
</body>
</html>